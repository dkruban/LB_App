<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Junior Fiesta - 42</title>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Bangers&family=Nunito:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #FF4757;
            --secondary: #2ED573;
            --accent: #FFA502;
            --dark: #2F3542;
            --gold: #FFD700;
            --silver: #C0C0C0;
            --bronze: #CD7F32;
            --card-bg: rgba(255, 255, 255, 0.95);
        }

        * { 
            box-sizing: border-box; margin: 0; padding: 0; 
            user-select: none; -webkit-tap-highlight-color: transparent; 
        }

        body {
            font-family: 'Nunito', sans-serif;
            background: radial-gradient(circle at center, #6C5CE7, #a29bfe, #fd79a8);
            background-size: 400% 400%;
            animation: gradientBG 20s ease infinite;
            min-height: 100vh;
            color: var(--dark);
            overflow-x: hidden;
            perspective: 1000px;
            touch-action: manipulation;
        }

        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* --- BACKGROUND --- */
        #bg-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; pointer-events: none; }

        /* --- INTRO --- */
        #intro-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.9); backdrop-filter: blur(10px);
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            z-index: 2000; transition: transform 1.5s cubic-bezier(0.68, -0.55, 0.27, 1.55);
        }
        #intro-screen.slide-up { transform: translateY(-100%); pointer-events: none; }

        .title-big {
            font-family: 'Fredoka One', cursive; font-size: clamp(3rem, 8vw, 6rem); color: #fff;
            text-shadow: 0 10px 0 var(--primary), 0 20px 0 var(--accent);
            animation: titlePump 2s infinite ease-in-out; text-align: center; line-height: 1.1;
        }
        @keyframes titlePump {
            0%, 100% { transform: scale(1) rotate(-2deg); }
            50% { transform: scale(1.05) rotate(2deg); }
        }

        .btn-main-start {
            padding: 20px 60px; font-size: 2rem; font-family: 'Fredoka One', cursive;
            background: linear-gradient(45deg, var(--secondary), #7bed9f); color: white; border: none;
            border-radius: 50px; box-shadow: 0 15px 0 #218c74, 0 20px 20px rgba(0,0,0,0.4);
            cursor: pointer; margin-top: 50px; transition: all 0.2s;
        }
        .btn-main-start:active { transform: translateY(15px); box-shadow: 0 0 0 #218c74; }

        /* --- APP --- */
        #app { max-width: 1000px; margin: 0 auto; padding: 20px; display: none; opacity: 0; transition: opacity 1s; position: relative; z-index: 10; }
        #app.visible { display: block; opacity: 1; }

        /* --- TOOLBAR --- */
        .toolbar {
            display: flex; justify-content: center; flex-wrap: wrap; gap: 15px;
            margin-bottom: 40px; background: var(--card-bg); padding: 20px; border-radius: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.2); border: 4px solid white;
        }
        .btn-tool {
            padding: 12px 25px; border: none; border-radius: 15px; font-weight: 900;
            cursor: pointer; font-family: 'Fredoka One', cursive; color: white;
            box-shadow: 0 6px 0 rgba(0,0,0,0.2); transition: all 0.1s;
        }
        .btn-tool:active { transform: translateY(6px); box-shadow: none; }
        .btn-add { background: linear-gradient(135deg, var(--secondary), #26de81); }
        .btn-refresh { background: linear-gradient(135deg, var(--accent), #f9ca24); }
        .btn-new-game { background: linear-gradient(135deg, var(--primary), #eb3b5a); }

        /* --- PODIUM --- */
        .section-title {
            text-align: center; font-family: 'Bangers', cursive; color: white;
            font-size: 3.5rem; text-shadow: 4px 4px 0 var(--dark), -2px -2px 0 var(--accent);
            margin-bottom: 30px; transform: rotate(-2deg);
        }
        .podium-stage { display: flex; justify-content: center; align-items: flex-end; height: 400px; margin-bottom: 60px; position: relative; }
        .podium-card { width: 200px; display: flex; flex-direction: column; align-items: center; margin: 0 10px; position: relative; }
        .avatar-xl { width: 120px; height: 120px; border-radius: 50%; border: 6px solid white; box-shadow: 0 15px 35px rgba(0,0,0,0.3); z-index: 20; position: relative; }
        .crown-icon { position: absolute; top: -60px; font-size: 4rem; z-index: 25; display: none; animation: floatCrown 3s infinite; }
        .podium-1 .crown-icon { display: block; }
        @keyframes floatCrown { 0%, 100% { transform: translateY(0) rotate(-5deg); } 50% { transform: translateY(-15px) rotate(5deg); } }
        .podium-body { width: 100%; border-radius: 25px 25px 0 0; display: flex; flex-direction: column; align-items: center; justify-content: flex-end; color: white; padding-bottom: 20px; padding-top: 70px; box-shadow: 0 20px 40px rgba(0,0,0,0.3); }
        .podium-1 { order: 2; z-index: 10; transform: scale(1.1); } .podium-1 .podium-body { height: 300px; background: linear-gradient(180deg, #ffd700, #ffa502); }
        .podium-2 { order: 1; z-index: 5; } .podium-2 .podium-body { height: 220px; background: linear-gradient(180deg, #dfe6e9, #b2bec3); }
        .podium-3 { order: 3; z-index: 4; } .podium-3 .podium-body { height: 180px; background: linear-gradient(180deg, #e17055, #d63031); }
        .podium-name { font-weight: 900; font-size: 1.4rem; text-shadow: 2px 2px 0 rgba(0,0,0,0.2); }
        .podium-score { font-family: 'Fredoka One', cursive; font-size: 2.5rem; background: rgba(0,0,0,0.2); padding: 5px 15px; border-radius: 15px; }

        /* --- LIST --- */
        .list-container { padding: 20px; }
        .list-row {
            display: flex; align-items: center; background: white; padding: 15px;
            margin-bottom: 15px; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            animation: slideInRow 0.5s ease-out;
        }
        @keyframes slideInRow { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .list-rank { font-family: 'Fredoka One', cursive; font-size: 2rem; width: 60px; color: #bdc3c7; text-shadow: 1px 1px 0 #fff; }
        .list-avatar { width: 70px; height: 70px; border-radius: 50%; margin-right: 20px; border: 4px solid #f1f2f6; }
        .list-info { flex-grow: 1; }
        .list-name { font-weight: 900; font-size: 1.4rem; color: var(--dark); }
        .list-controls { display: flex; align-items: center; gap: 10px; }
        .score-box { 
            font-family: 'Fredoka One', cursive; font-size: 2rem; color: var(--dark); 
            min-width: 80px; text-align: center; cursor: pointer; background: #f1f2f6; border-radius: 12px; padding: 5px 10px;
        }
        .btn-ctrl {
            width: 50px; height: 50px; border-radius: 15px; border: none; cursor: pointer;
            display: flex; align-items: center; justify-content: center; font-size: 1.5rem; font-weight: bold;
            font-family: 'Fredoka One'; box-shadow: 0 5px 0 rgba(0,0,0,0.15); transition: all 0.1s;
        }
        .btn-ctrl:active { transform: translateY(5px); box-shadow: none; }
        .btn-plus { background: #2ed573; color: white; }
        .btn-minus { background: #ff6b81; color: white; }
        .btn-del { background: #a4b0be; color: white; font-size: 1.2rem; width: 40px; height: 40px;}

        /* --- EFFECTS --- */
        #effects-layer { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 9999; }
        .floating-text { position: absolute; font-family: 'Fredoka One', cursive; font-weight: 900; font-size: 2rem; pointer-events: none; z-index: 10000; animation: floatUpFade 1s ease-out forwards; }
        @keyframes floatUpFade { 0% { opacity: 1; transform: translateY(0) scale(0.5); } 100% { opacity: 0; transform: translateY(-50px) scale(1); } }

        /* --- MODAL --- */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.7); backdrop-filter: blur(8px);
            display: flex; justify-content: center; align-items: center; z-index: 3000;
            opacity: 0; pointer-events: none; transition: opacity 0.3s;
        }
        .modal-overlay.active { opacity: 1; pointer-events: all; }
        .modal-card { background: white; padding: 40px; border-radius: 40px; width: 90%; max-width: 450px; text-align: center; }
        input { 
            width: 100%; padding: 20px; border: 4px solid #eee; border-radius: 20px; 
            font-size: 1.5rem; margin-bottom: 25px; font-family: 'Fredoka One'; text-align: center;
        }
        #toast {
            position: fixed; top: 20px; left: 50%; transform: translateX(-50%) translateY(-100px);
            background: var(--dark); color: white; padding: 15px 40px; border-radius: 50px;
            font-weight: bold; font-family: 'Fredoka One'; font-size: 1.2rem; z-index: 5000;
            transition: transform 0.5s; border: 4px solid white;
        }
        #toast.show { transform: translateX(-50%) translateY(0); }
    </style>
</head>
<body>

    <canvas id="bg-canvas"></canvas>
    <div id="effects-layer"></div>
    <div id="toast">Action!</div>

    <div id="intro-screen">
        <h1 class="title-big">JUNIOR<br>FIESTA<br><span style="font-size:0.5em; color:var(--accent);">42</span></h1>
        <button class="btn-main-start" onclick="startApp()">START BATTLE!</button>
    </div>

    <div id="app">
        <div class="toolbar">
            <button class="btn-tool btn-add" onclick="openAddModal()">+ Add Player</button>
            <button class="btn-tool btn-refresh" onclick="fetchGitHubData()">üîÑ Sync</button>
            <button class="btn-tool btn-new-game" onclick="newGame()">üéÆ New Game</button>
        </div>

        <h2 class="section-title">üëë HALL OF FAME üëë</h2>
        <div class="podium-stage" id="podium-container"></div>

        <h2 class="section-title" style="font-size: 2rem; color: var(--dark); margin-top: 50px; text-shadow: 2px 2px 0 white;">‚öîÔ∏è LEADERBOARD ‚öîÔ∏è</h2>
        <div class="list-container" id="player-list"></div>
    </div>

    <!-- ADD PLAYER MODAL -->
    <div class="modal-overlay" id="name-modal">
        <div class="modal-card">
            <h2 style="font-family: 'Fredoka One'; color: var(--secondary); margin-bottom:10px;">Add Player</h2>
            <input type="text" id="player-name-input" placeholder="Enter Name..." autocomplete="off">
            <div style="display:flex; justify-content:space-between; gap:15px;">
                <button class="btn-tool btn-new-game" style="flex:1; font-size:1.2rem;" onclick="closeModal('name-modal')">Cancel</button>
                <button class="btn-tool btn-add" style="flex:1; font-size:1.2rem;" onclick="saveName()">Save</button>
            </div>
        </div>
    </div>

    <!-- SCORE EDIT MODAL -->
    <div class="modal-overlay" id="score-modal">
        <div class="modal-card">
            <h2 style="font-family: 'Fredoka One'; color: var(--accent); margin-bottom:10px;">Update Score</h2>
            <input type="number" id="score-input" placeholder="0">
            <div style="display:flex; justify-content:space-between; gap:15px;">
                <button class="btn-tool btn-new-game" style="flex:1; font-size:1.2rem;" onclick="closeModal('score-modal')">Cancel</button>
                <button class="btn-tool btn-add" style="flex:1; font-size:1.2rem;" onclick="saveScoreManual()">Update</button>
            </div>
        </div>
    </div>

    <script>
        // ==========================================
        // 1. GITHUB CONFIGURATION
        // ==========================================
        
        // ‚ö†Ô∏è WARNING: Do NOT share this file with others if you want to keep this token safe.
        // Anyone who sees this code can see your token.
        
        const GITHUB_OWNER = "dkruban";       // MUST CHANGE THIS (Example: "johndoe")
        const GITHUB_REPO = "LB_App";       // MUST CHANGE THIS (Example: "junior-fiesta")
        const GITHUB_TOKEN = "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"; // Token provided by user
        const DATA_FILE = "data.json";
        
        // API URL to be built dynamically
        let API_URL = `https://api.github.com/repos/${GITHUB_OWNER}/${GITHUB_REPO}/contents/${DATA_FILE}`;

        // ==========================================
        // 2. APP STATE & LOGIC
        // ==========================================
        let players = [];
        let editingScoreId = null; 
        let currentFileSHA = null; // Needed to update the file safely

        // Helper: UTF8 Base64 encoding/decoding for GitHub API
        function utf8_to_b64(str) {
            return window.btoa(unescape(encodeURIComponent(str)));
        }
        function b64_to_utf8(str) {
            return decodeURIComponent(escape(window.atob(str)));
        }

        // --- FETCH DATA FROM GITHUB ---
        function fetchGitHubData() {
            // Ensure URL is constructed with updated config just in case (for local testing edits)
            API_URL = `https://api.github.com/repos/${GITHUB_OWNER}/${GITHUB_REPO}/contents/${DATA_FILE}`;

            showToast("Syncing with GitHub...");
            fetch(API_URL)
                .then(response => {
                    if (!response.ok) throw new Error(response.statusText);
                    return response.json();
                })
                .then(data => {
                    if (data.content) {
                        currentFileSHA = data.sha;
                        try {
                            players = JSON.parse(b64_to_utf8(data.content));
                            renderApp();
                            showToast("Synced!");
                        } catch (e) {
                            console.error("JSON Parse Error", e);
                            showToast("Data Corrupted!");
                        }
                    } else {
                        // File content missing
                        showToast("Empty Data");
                    }
                })
                .catch(error => {
                    console.error("Error fetching:", error);
                    // Likely 404 (File doesn't exist)
                    showToast("File not found. Add a player to create it.");
                    players = [];
                    renderApp();
                });
        }

        // --- SAVE DATA TO GITHUB ---
        function pushGitHubData() {
            // Ensure URL is constructed
            API_URL = `https://api.github.com/repos/${GITHUB_OWNER}/${GITHUB_REPO}/contents/${DATA_FILE}`;

            if (!GITHUB_TOKEN || GITHUB_TOKEN === "ghp_xxxxxxxxxxxxxx") {
                alert("Token error.");
                return;
            }

            const contentBase64 = utf8_to_b64(JSON.stringify(players));
            
            const body = {
                message: "Update scores via Junior Fiesta",
                content: contentBase64,
            };

            // If SHA exists (file already there), we must include it
            if (currentFileSHA) {
                body.sha = currentFileSHA;
            }

            fetch(API_URL, {
                method: 'PUT',
                headers: {
                    'Authorization': `token ${GITHUB_TOKEN}`,
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(body)
            })
            .then(response => {
                if(response.ok) {
                    return response.json();
                } else {
                    return response.json().then(err => { throw new Error(err.message); });
                }
            })
            .then(data => {
                currentFileSHA = data.content.sha; // Update SHA for next save
                showToast("Saved to GitHub!");
            })
            .catch(error => {
                console.error("Error saving:", error);
                alert("Failed to save: " + error.message);
            });
        }

        // --- START APP ---
        function startApp() {
            document.getElementById('intro-screen').classList.add('slide-up');
            document.getElementById('app').style.display = 'block';
            setTimeout(() => {
                document.getElementById('app').classList.add('visible');
                fetchGitHubData(); // Load data immediately
            }, 100);
            initBackground();
        }

        // --- RENDERING ---
        function renderApp() {
            players.sort((a, b) => b.score - a.score);
            renderPodium();
            renderList();
        }

        function getAvatar(name) {
            return `https://api.dicebear.com/7.x/fun-emoji/svg?seed=${name}&backgroundColor=b6e3f4,c0aede,d1d4f9`;
        }

        function renderPodium() {
            const container = document.getElementById('podium-container');
            container.innerHTML = '';
            let top3 = [players[1], players[0], players[2]].filter(p => p !== undefined);

            if (players.length === 0) {
                container.innerHTML = '<p style="color:white; font-family:"Fredoka One"; text-align:center;">No players yet!</p>';
                return;
            }

            top3.forEach((p, index) => {
                let rankClass = index === 0 ? 'podium-2' : (index === 1 ? 'podium-1' : 'podium-3');
                const el = document.createElement('div');
                el.className = `podium-card ${rankClass}`;
                el.innerHTML = `
                    <div class="crown-icon">üëë</div>
                    <img src="${getAvatar(p.name)}" class="avatar-xl">
                    <div class="podium-body">
                        <div class="podium-name">${p.name}</div>
                        <div class="podium-score">${p.score}</div>
                    </div>
                `;
                container.appendChild(el);
            });
        }

        function renderList() {
            const list = document.getElementById('player-list');
            list.innerHTML = '';

            if (players.length === 0) {
                list.innerHTML = '<p style="text-align:center; color:#7f8c8d; font-family: Fredoka One;">No fighters in the ring!</p>';
                return;
            }

            players.forEach((p, index) => {
                const row = document.createElement('div');
                row.className = 'list-row';
                row.innerHTML = `
                    <div class="list-rank">#${index + 1}</div>
                    <img src="${getAvatar(p.name)}" class="list-avatar">
                    <div class="list-info">
                        <div class="list-name">${p.name}</div>
                    </div>
                    <div class="list-controls">
                        <button class="btn-ctrl btn-minus" onclick="changeScore(${index}, -5)">‚àí</button>
                        <button class="btn-ctrl btn-plus" onclick="changeScore(${index}, 5)">+</button>
                        <div class="score-box" onclick="openScoreModal(${index})">${p.score}</div>
                        <button class="btn-ctrl btn-del" onclick="deletePlayer(${index})">üóë</button>
                    </div>
                `;
                list.appendChild(row);
            });
        }

        // --- ACTIONS ---
        function changeScore(index, delta) {
            players[index].score += delta;
            renderApp();
            pushGitHubData(); // Auto-save to GitHub
        }

        function deletePlayer(index) {
            if(confirm('Knock this player out?')) {
                players.splice(index, 1);
                renderApp();
                pushGitHubData();
            }
        }

        function newGame() {
            if(confirm("Start a new season?")) {
                players.forEach(p => p.score = 0);
                renderApp();
                pushGitHubData();
            }
        }

        // --- MODALS ---
        function openAddModal() {
            editingScoreId = null; 
            document.getElementById('player-name-input').value = ''; 
            document.getElementById('name-modal').classList.add('active');
        }

        function openScoreModal(index) {
            editingScoreId = index;
            document.getElementById('score-input').value = players[index].score;
            document.getElementById('score-modal').classList.add('active');
        }

        function closeModal(id) { document.getElementById(id).classList.remove('active'); }

        function saveName() {
            const name = document.getElementById('player-name-input').value.trim();
            if(!name) return showToast("Name required!");
            
            players.push({ id: Date.now(), name: name, score: 0 });
            closeModal('name-modal');
            renderApp();
            pushGitHubData();
        }

        function saveScoreManual() {
            const val = parseInt(document.getElementById('score-input').value);
            if(!isNaN(val) && editingScoreId !== null) {
                players[editingScoreId].score = val;
                closeModal('score-modal');
                renderApp();
                pushGitHubData();
            }
        }

        function showToast(msg) {
            const t = document.getElementById('toast');
            t.innerText = msg; 
            t.classList.add('show');
            setTimeout(() => t.classList.remove('show'), 2500);
        }

        // --- CANVAS BACKGROUND ---
        const canvas = document.getElementById("bg-canvas");
        const ctx = canvas.getContext("2d");
        let particles = [];
        let bgParticles = [];

        function resize() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
        window.addEventListener('resize', resize); resize();

        class Particle {
            constructor(x, y, color) {
                this.x = x; this.y = y; this.size = Math.random() * 8 + 4;
                this.speedX = Math.random() * 10 - 5; this.speedY = Math.random() * -10 - 5;
                this.gravity = 0.5; this.color = color || `hsl(${Math.random()*360}, 100%, 50%)`;
                this.rotation = Math.random() * 360; this.rotationSpeed = Math.random() * 10 - 5;
                this.life = 100;
            }
            update() {
                this.x += this.speedX; this.y += this.speedY; this.speedY += this.gravity;
                this.rotation += this.rotationSpeed; this.life -= 1.5;
            }
            draw() {
                ctx.save(); ctx.translate(this.x, this.y); ctx.rotate(this.rotation * Math.PI / 180);
                ctx.fillStyle = this.color; ctx.fillRect(-this.size/2, -this.size/2, this.size, this.size);
                ctx.restore();
            }
        }

        function fireConfetti(x, y, amount = 50) {
            for(let i=0; i<amount; i++) particles.push(new Particle(x, y));
        }

        function initBackground() {
            for(let i=0; i<20; i++) {
                bgParticles.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height,
                    size: Math.random() * 30 + 20,
                    speedY: Math.random() * 1 + 0.2,
                    emoji: ['ü•ä', 'üèÜ', 'üëë', 'üî•', '‚≠ê'][Math.floor(Math.random()*5)],
                    update: function() { this.y -= this.speedY; if(this.y < -50) this.reset(); },
                    reset: function() { this.y = canvas.height + 50; this.x = Math.random() * canvas.width; },
                    draw: function() { ctx.font = `${this.size}px Arial`; ctx.fillText(this.emoji, this.x, this.y); }
                });
            }
            animateParticles();
        }

        function animateParticles() {
            ctx.clearRect(0,0,canvas.width, canvas.height);
            bgParticles.forEach(p => { p.update(); p.draw(); });
            for(let i=0; i<particles.length; i++) {
                let p = particles[i]; p.update(); p.draw();
                if(p.life<=0 || p.y>canvas.height) { particles.splice(i,1); i--; }
            }
            requestAnimationFrame(animateParticles);
        }
    </script>
</body>
</html>
